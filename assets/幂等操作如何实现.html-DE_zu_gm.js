import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as o,d as l,o as i}from"./app-BsnKshpw.js";const n={};function a(r,t){return i(),o("div",null,t[0]||(t[0]=[l('<h1 id="幂等操作如何实现" tabindex="-1"><a class="header-anchor" href="#幂等操作如何实现"><span>幂等操作如何实现</span></a></h1><p>幂等操作大致可以分为两种，一种是客户端幂等操作，一种是服务端幂等操作<br> 区别就在于是哪一方发起的请求<br> 如果是客户端发起的请求，那就是客户端幂等<br> 如果是服务器间发起的请求，就是服务器端幂等（例如服务 A 调用服务 B，B 是否需要支持幂等呢？）</p><h3 id="客户端幂等操作" tabindex="-1"><a class="header-anchor" href="#客户端幂等操作"><span>客户端幂等操作</span></a></h3><p>重复提交表单，比如</p><ul><li>重复下订单</li><li>消耗金币、钻石、抽奖券进行抽奖时，连续点击导致的并发，这个是否需要进行幂等</li></ul><p><strong>解决方案：</strong></p><ul><li>增加一步向后台申请 token 的操作</li><li>客户端在提交表单时需要携带这个 token</li><li>服务器根据这个 token 做如下判断（token 在使用后存在 Redis 中） <ul><li>token 存在：已经使用过，拒绝请求直接返回</li><li>token 不存在：请求第一次进来，进行后续业务操作<br> （或者说根据表单里面的一些数据，组合成唯一的键，来确定是否已入库进而实现幂等）</li></ul></li></ul><h3 id="服务器端幂等操作" tabindex="-1"><a class="header-anchor" href="#服务器端幂等操作"><span>服务器端幂等操作</span></a></h3><ul><li>消息重复消费</li><li>扣减库存</li><li>短信通知</li></ul><p>以扣减库存为例<br> 扣减库存时，需要几个重要参数，<em>订单 ID、SKU、扣减数量</em></p><p>一个订单只能进行一次库存扣减，如果在库存扣减记录表中已经存在了相关的扣减记录，那就拒绝请求，直接返回，若没有才进行后续的业务操作</p><h2 id="幂等的类型" tabindex="-1"><a class="header-anchor" href="#幂等的类型"><span>幂等的类型</span></a></h2><ul><li>弱幂等<br> cache 内判断<br> 如短信发送</li><li>强幂等<br> 数据库内判断<br> 像金额扣减、库存扣减</li></ul>',13)]))}const s=e(n,[["render",a],["__file","幂等操作如何实现.html.vue"]]),h=JSON.parse(`{"path":"/inbox/%E5%B9%82%E7%AD%89%E6%93%8D%E4%BD%9C%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0.html","title":"幂等操作如何实现","lang":"zh-CN","frontmatter":{"title":"幂等操作如何实现","tag":[],"description":"幂等操作如何实现 幂等操作大致可以分为两种，一种是客户端幂等操作，一种是服务端幂等操作 区别就在于是哪一方发起的请求 如果是客户端发起的请求，那就是客户端幂等 如果是服务器间发起的请求，就是服务器端幂等（例如服务 A 调用服务 B，B 是否需要支持幂等呢？） 客户端幂等操作 重复提交表单，比如 重复下订单 消耗金币、钻石、抽奖券进行抽奖时，连续点击导致...","head":[["meta",{"property":"og:url","content":"https://logycoconut.github.io/inbox/%E5%B9%82%E7%AD%89%E6%93%8D%E4%BD%9C%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0.html"}],["meta",{"property":"og:site_name","content":"logycoconut's k-lab"}],["meta",{"property":"og:title","content":"幂等操作如何实现"}],["meta",{"property":"og:description","content":"幂等操作如何实现 幂等操作大致可以分为两种，一种是客户端幂等操作，一种是服务端幂等操作 区别就在于是哪一方发起的请求 如果是客户端发起的请求，那就是客户端幂等 如果是服务器间发起的请求，就是服务器端幂等（例如服务 A 调用服务 B，B 是否需要支持幂等呢？） 客户端幂等操作 重复提交表单，比如 重复下订单 消耗金币、钻石、抽奖券进行抽奖时，连续点击导致..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-11T14:19:39.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-11T14:19:39.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"幂等操作如何实现\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-02-11T14:19:39.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"logycoconut\\",\\"url\\":\\"https://logycoconut.github.io/\\"}]}"]]},"headers":[{"level":3,"title":"客户端幂等操作","slug":"客户端幂等操作","link":"#客户端幂等操作","children":[]},{"level":3,"title":"服务器端幂等操作","slug":"服务器端幂等操作","link":"#服务器端幂等操作","children":[]},{"level":2,"title":"幂等的类型","slug":"幂等的类型","link":"#幂等的类型","children":[]}],"git":{"createdTime":1726242132000,"updatedTime":1739283579000,"contributors":[{"name":"logycoconut","username":"logycoconut","email":"logycoconut@foxmail.com","commits":2,"url":"https://github.com/logycoconut"}]},"readingTime":{"minutes":1.49,"words":446},"filePathRelative":"inbox/幂等操作如何实现.md","localizedDate":"2024年9月13日","autoDesc":true}`);export{s as comp,h as data};
